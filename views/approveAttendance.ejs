<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">

    <title>Document</title>

    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        /* Button used to open the contact form - fixed at the bottom of the page */
        .open-button {
            background-color: #555;
            color: white;
            border: none;
            cursor: pointer;
            position: fixed;
        }

        /* The popup form - hidden by default */
        .form-popup {
            display: none;
            position: fixed;
            border: 3px solid #f1f1f1;
            z-index: 9;
            background-color: white;
            width: 400px;
            height: 270px;
            align-content: center;
            align-items: center;
            margin-top: 56px;
        }

        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td,
        th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }
    </style>
</head>

<body>

    <%- include('./partials/flash')%>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/user">Me</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="#">Leave</a>
                    </li> -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Request
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/attendance/correction">Attendance Correction</a></li>
                            <li><a class="dropdown-item" href="/attendance">Attendance</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Approvals
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/correction/attendance">Attendance Correction</a></li>
                            <li><a class="dropdown-item" href="/approve/attendance">Attendance</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " aria-current="page" href="/documents">Documents</a>
                    </li>
                    <%  if( employees.role  === 'Admin'){ %>
                        <li class="nav-item">
                          <a class="nav-link " aria-current="page" href="/employeeDirectory">Employ Directory</a>
                        </li>
                        <% } else {%>
                            <li class="nav-item">
                              <a class="nav-link " aria-current="page" href="/search">Search</a>
                            </li>
                          <% } %> 
                </ul>

                <ul class="navbar-nav mr-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <%= employees.username %>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <form action="/profile">
                                <button class="btn btn-light">Profile</button>
                            </form>
                            <form action="/logout" method="POST">
                                <button class="btn btn-light">Logout</button>
                            </form>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        </div>
    </nav>

    <div class="container mt-4">
        <table>
            <tr>
                <th>Username</th>
                <th>Date</th>
                <th>Punch In</th>
                <th>Punch Out</th>
                <th>Status</th>
                <th>Approve/Reject</th>
            </tr>
            <% if(approve){ %>
            <% for(let i of approve) { %>
                <tr>
                <% for(let j of userlist) { %>
                   <% const a = i.userId %> 
                    <% const b = j._id %>
                    <% console.log("a: ", a) %> 
                    <% console.log("b: ", b) %> 
                 <% if( a.equals(b) ) { %>
                
                <td> <%= j.username %></td>
                <% console.log("b: ", b) %> 
                <% break %> 
                 <% } %> 
                <% } %>

                <td> <%= i.date %> </td>
                <td> <%= i.checkin %> </td>
                <td> <%= i.checkout %> </td>
                <td> <%= i.status %> </td>
                <td>
                    <% if(i.checkout !== null)  {%> 
                    <div class="container">
                    <div class="row">
                      <div class="col-sm-3 col-md-3">
                         <form action="/approve/attendance/<%= i._id %>?_method=PUT" method="POST">
                          <button class="btn btn-success" id="statusbutton" type="submit" name="status" value="Approved">Approve</button>
                         </form>
                      </div>
                      <div class="col-sm-3 col-md-3">
                        <form action="/approve/attendance/<%= i._id %>?_method=PUT" method="POST">
                          <button class="btn btn-danger" id="statusbutton"  type="submit" name="status" value="Rejected">Reject</button>
                         </form>
                      </div>
                    </div>
                  </div></td>
                  <td><% if(i.status !== 'Pending') {%>
                    <p>Done</p>
                    <% } %>  

                  <% } %> 
                    </td>
                
            </tr>
            <% } %>
            <% } %>
        </form>
        </table>

    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
        crossorigin="anonymous"></script>
</body>

</html>